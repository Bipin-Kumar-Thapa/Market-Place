{% extends 'master/base.html' %}
{% load static %}

{% block content %}
<!-- ========================= SECTION MAIN ========================= -->
<section class="section-intro padding-y-sm">
  <div class="container">
    <div id="bannerCarousel" class="carousel slide" data-ride="carousel">
      <div class="carousel-inner">
        
        {% for banner in banners %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
          
          {% if banner.banner_video %}
            <!-- If there is a video, display it -->
            <video class="d-block w-100 img-fluid rounded" autoplay muted loop>
              <source src="{{ banner.banner_video.url }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          {% elif banner.banner_image %}
            <!-- If there is an image, display it -->
            <img
              src="{{ banner.banner_image.url }}"
              class="d-block w-100 img-fluid rounded"
              alt="Banner {{ forloop.counter }}"
            />
          {% endif %}
        </div>
        {% endfor %}
      </div>

      <!-- Carousel controls -->
      <a class="carousel-control-prev" href="#bannerCarousel" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#bannerCarousel" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
  </div>
</section>
<!-- ========================= SECTION MAIN END// ========================= -->

<!-- ========================= POPULAR PRODUCTS SECTION ========================= -->
<section class="section-name padding-y-sm">
  <div class="container">
    <header class="section-heading">
      <a href="{% url 'store' %}" class="btn btn-outline-primary float-right">See all</a>
      <h3 class="section-title">Popular products</h3>
    </header>
    <!-- sect-heading -->

    <!-- Carousel for Popular Products -->
    <div id="productCarousel" class="carousel slide" data-ride="carousel" data-interval="false">
      <div class="carousel-inner">

        {% for product in products|slice:":12" %}
          {% if forloop.first or forloop.counter0|divisibleby:4 %}
          <div class="carousel-item {% if forloop.first %}active{% endif %}">
            <div class="row">
          {% endif %}

          <div class="col-md-3">
            <div class="card card-product-grid">
              <a href="{{ product.get_url }}" class="img-wrap">
                <img src="{{ product.images.url }}" class="img-fluid" />
              </a>
              <figcaption class="info-wrap" style="font-size:12px;">
                <a href="{{ product.get_url }}" class="title">
                  {{ product.product_name|truncatechars:70 }}
                </a>
                <div class="price mt-1">
                  {% if product.discount_price %}
                    <!-- Display discount price with original price crossed out -->
                    <span class="price">Rs.{{ product.discount_price }}</span>
                    <del class="price-old">Rs.{{ product.price }}</del>
                  {% else %}
                    <!-- If no discount, show the regular price -->
                    <span class="price">Rs.{{ product.price }}</span>
                  {% endif %}
                </div>
              </figcaption>
            </div>
          </div>

          {% if forloop.counter|divisibleby:4 or forloop.last %}
            </div>
          </div>
          {% endif %}
        {% endfor %}

      </div>

      <!-- Carousel controls -->
      <a class="carousel-control-prev" href="#productCarousel" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#productCarousel" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
  </div>
</section>
<!-- ========================= POPULAR PRODUCTS END// ========================= -->

{% include 'home/includes/categories.html' %}

<!-- ========================= DISCOUNTED PRODUCTS SECTION ========================= -->
<section class="section-discounted-products padding-y-sm">
  <div class="container">
    <header class="section-heading">
      <a href="{% url 'store' %}?discounted=true" class="btn btn-outline-primary float-right">See all</a>
      <h3 class="section-title">Discounted Products</h3>
    </header>
    
    <!-- Carousel for Discounted Products -->
    <div id="discountedProductCarousel" class="carousel slide" data-ride="carousel" data-interval="false">
      <div class="carousel-inner">
        {% for product in products|slice:":4"%}
          {% if product.discount_price %}
            {% if forloop.first or forloop.counter0|divisibleby:4 %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <div class="row">
            {% endif %}

            <div class="col-md-3">
              <div class="card card-product-grid">
                <a href="{{ product.get_url }}" class="img-wrap">
                  <img src="{{ product.images.url }}" class="img-fluid" />
                </a>
                <figcaption class="info-wrap" style="font-size:12px;">
                  <a href="{{ product.get_url }}" class="title">
                    {{ product.product_name|truncatechars:70 }}
                  </a>
                  <div class="price mt-1">
                    <span class="price">Rs.{{ product.discount_price }}</span>
                    <del class="price-old">Rs.{{ product.price }}</del>
                  </div>
                </figcaption>
              </div>
            </div>

            {% if forloop.counter|divisibleby:4 or forloop.last %}
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</section>
<!-- ========================= DISCOUNTED PRODUCTS END// ========================= -->


<style>
  body {
    background-color: #f8f9fa;
  }

  /* Existing carousel styles */
  .carousel-control-prev-icon,
  .carousel-control-next-icon {
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    background-size: 20px 20px;
    background-position: center;
    background-repeat: no-repeat;
  }

  .carousel-control-prev,
  .carousel-control-next {
    width: 40px;
    height: 40px;
    top: 50%;
    transform: translateY(-50%);
  }

  .carousel-control-prev:hover,
  .carousel-control-next:hover {
    background-color: rgba(0, 0, 0, 0.7);
  }

  .carousel-control-prev-icon::after,
  .carousel-control-next-icon::after {
    font-size: 20px;
    color: #fff;
  }

  /* Banner size and background color (already applied) */
  #bannerCarousel .carousel-item img {
    height: 400px; /* Image height */
    object-fit: cover; /* Ensure image covers the container */
    width: 100%;
  }

  #bannerCarousel .carousel-item video {
    height: 400px; /* Ensure video takes full height of the carousel item */
    object-fit: cover; /* Ensure video covers the area without distortion */
    width: 100%; /* Ensure video stretches to full width */
  }

  #bannerCarousel {
    height: 400px; /* Set the fixed height for the carousel */
  }

  /* Discounted Products section custom styles */
  .section-discounted-products .section-title {
    color: #333;
    font-weight: bold;
    font-size: 1.5em;
  }

  .section-discounted-products .carousel-inner {
    padding-top: 20px;
  }
</style>

{% endblock %}
